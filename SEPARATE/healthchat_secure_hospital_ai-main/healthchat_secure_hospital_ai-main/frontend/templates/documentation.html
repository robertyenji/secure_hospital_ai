<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - SecureHospital AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #10b981;
            --accent: #8b5cf6;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --darker: #020617;
            --card: #1e293b;
            --card-hover: #334155;
            --border: #334155;
            --text: #f1f5f9;
            --muted: #94a3b8;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--darker);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
        }

        /* Navigation */
        .navbar {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--text) !important;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .brand-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-link {
            color: var(--muted) !important;
            font-weight: 500;
            padding: 8px 16px !important;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--text) !important;
            background: var(--card);
        }

        /* Layout */
        .docs-layout {
            display: flex;
            margin-top: 70px;
            min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .docs-sidebar {
            width: 280px;
            min-width: 280px;
            background: var(--dark);
            border-right: 1px solid var(--border);
            padding: 30px 20px;
            position: fixed;
            top: 70px;
            bottom: 0;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 28px;
        }

        .sidebar-title {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--muted);
            margin-bottom: 12px;
            padding-left: 12px;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li a {
            display: block;
            padding: 10px 12px;
            color: var(--muted);
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .sidebar-nav li a:hover {
            background: var(--card);
            color: var(--text);
        }

        .sidebar-nav li a.active {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .sidebar-nav li a i {
            width: 20px;
            margin-right: 8px;
            opacity: 0.7;
        }

        /* Main Content */
        .docs-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px 60px 100px;
            max-width: 900px;
        }

        .docs-header {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid var(--border);
        }

        .docs-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--text), var(--muted));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .docs-subtitle {
            font-size: 1.1rem;
            color: var(--muted);
        }

        /* Content Styles */
        h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-top: 50px;
            margin-bottom: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            color: var(--text);
        }

        h2:first-of-type {
            border-top: none;
            margin-top: 0;
            padding-top: 0;
        }

        h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 32px;
            margin-bottom: 16px;
            color: var(--primary);
        }

        h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 12px;
        }

        p {
            color: var(--muted);
            margin-bottom: 16px;
        }

        ul, ol {
            color: var(--muted);
            padding-left: 24px;
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 8px;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Code Blocks */
        code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            background: var(--card);
            padding: 3px 8px;
            border-radius: 4px;
            color: var(--secondary);
        }

        pre {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            margin: 20px 0;
            position: relative;
        }

        pre code {
            background: none;
            padding: 0;
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--text);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--border);
            margin: -20px -20px 16px -20px;
            padding: 10px 16px;
            border-radius: 12px 12px 0 0;
            font-size: 0.8rem;
            color: var(--muted);
        }

        .code-header .lang {
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .copy-btn {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Info Boxes */
        .info-box {
            border-radius: 12px;
            padding: 20px;
            margin: 24px 0;
            display: flex;
            gap: 16px;
        }

        .info-box i {
            font-size: 1.2rem;
            margin-top: 2px;
        }

        .info-box-content h4 {
            margin: 0 0 8px 0;
            font-size: 1rem;
        }

        .info-box-content p {
            margin: 0;
            font-size: 0.9rem;
        }

        .info-box.info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .info-box.info i { color: var(--primary); }

        .info-box.warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .info-box.warning i { color: var(--warning); }

        .info-box.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .info-box.success i { color: var(--secondary); }

        .info-box.danger {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .info-box.danger i { color: var(--danger); }

        /* Feature Cards */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .feature-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.2s;
        }

        .feature-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .feature-card i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .feature-card h4 {
            margin: 0 0 8px 0;
            font-size: 1rem;
            color: var(--text);
        }

        .feature-card p {
            margin: 0;
            font-size: 0.85rem;
        }

        /* Architecture Diagram */
        .architecture-box {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 30px;
            margin: 24px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.8;
            overflow-x: auto;
        }

        .architecture-box pre {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
        }

        /* Steps */
        .step {
            display: flex;
            gap: 20px;
            margin: 24px 0;
            padding: 20px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin: 0 0 8px 0;
            color: var(--text);
        }

        .step-content p {
            margin: 0;
            font-size: 0.9rem;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--card);
            font-weight: 600;
            color: var(--text);
        }

        td {
            color: var(--muted);
        }

        td code {
            font-size: 0.8rem;
        }

        /* Footer */
        .docs-footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .docs-footer a {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--muted);
            transition: all 0.2s;
        }

        .docs-footer a:hover {
            background: var(--card-hover);
            border-color: var(--primary);
            color: var(--primary);
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .docs-sidebar {
                display: none;
            }
            .docs-content {
                margin-left: 0;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="navbar">
    <div class="container-fluid px-4">
        <div class="d-flex align-items-center justify-content-between w-100">
            <a class="navbar-brand" href="/">
                <div class="brand-icon">ğŸ¥</div>
                SecureHospital AI
            </a>
            
            <div class="d-flex align-items-center gap-2">
                <a href="{% url 'frontend:documentation' %}" class="nav-link active">Docs</a>
                <a href="{% url 'frontend:api_reference' %}" class="nav-link">API Reference</a>
                <a href="https://github.com" target="_blank" class="nav-link">
                    <i class="fab fa-github"></i>
                </a>
                <a href="{% url 'login' %}" class="btn btn-primary btn-sm ms-2">
                    Try Demo <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
        </div>
    </div>
</nav>

<div class="docs-layout">
    <!-- Sidebar -->
    <aside class="docs-sidebar">
        <div class="sidebar-section">
            <div class="sidebar-title">Getting Started</div>
            <ul class="sidebar-nav">
                <li><a href="#overview" class="active"><i class="fas fa-home"></i> Overview</a></li>
                <li><a href="#architecture"><i class="fas fa-sitemap"></i> Architecture</a></li>
                <li><a href="#features"><i class="fas fa-star"></i> Features</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Installation</div>
            <ul class="sidebar-nav">
                <li><a href="#prerequisites"><i class="fas fa-check-circle"></i> Prerequisites</a></li>
                <li><a href="#local-setup"><i class="fas fa-laptop-code"></i> Local Setup</a></li>
                <li><a href="#demo-data"><i class="fas fa-database"></i> Demo Data</a></li>
                <li><a href="#docker"><i class="fab fa-docker"></i> Docker Setup</a></li>
                <li><a href="#environment"><i class="fas fa-cog"></i> Environment</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Configuration</div>
            <ul class="sidebar-nav">
                <li><a href="#database"><i class="fas fa-database"></i> Database</a></li>
                <li><a href="#openai"><i class="fas fa-robot"></i> OpenAI Setup</a></li>
                <li><a href="#mcp-server"><i class="fas fa-server"></i> MCP Server</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Security</div>
            <ul class="sidebar-nav">
                <li><a href="#rbac"><i class="fas fa-user-shield"></i> RBAC</a></li>
                <li><a href="#audit-logging"><i class="fas fa-clipboard-list"></i> Audit Logging</a></li>
                <li><a href="#phi-protection"><i class="fas fa-lock"></i> PHI Protection</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Resources</div>
            <ul class="sidebar-nav">
                <li><a href="{% url 'frontend:api_reference' %}"><i class="fas fa-code"></i> API Reference</a></li>
                <li><a href="#troubleshooting"><i class="fas fa-wrench"></i> Troubleshooting</a></li>
            </ul>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="docs-content">
        <div class="docs-header">
            <h1 class="docs-title">Documentation</h1>
            <p class="docs-subtitle">
                Learn how to run SecureHospital AI locally and understand its security architecture.
            </p>
        </div>

        <!-- Overview -->
        <section id="overview">
            <h2>Overview</h2>
            <p>
                SecureHospital AI is an enterprise-grade healthcare AI demonstration platform that showcases 
                how to safely integrate Large Language Models (LLMs) with sensitive healthcare data. It implements 
                a three-layer security architecture using Django, FastAPI, and the Model Context Protocol (MCP).
            </p>

            <div class="feature-grid">
                <div class="feature-card">
                    <i class="fas fa-user-shield"></i>
                    <h4>Role-Based Access Control</h4>
                    <p>Fine-grained permissions based on healthcare roles (Doctor, Nurse, Admin, etc.)</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-clipboard-list"></i>
                    <h4>Complete Audit Trail</h4>
                    <p>Every data access is logged with user, timestamp, and action details</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-lock"></i>
                    <h4>PHI Protection</h4>
                    <p>Protected Health Information is access-controlled and redacted based on role</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-robot"></i>
                    <h4>AI Integration</h4>
                    <p>OpenAI GPT with MCP tools for secure healthcare data queries</p>
                </div>
            </div>
        </section>

        <!-- Architecture -->
        <section id="architecture">
            <h2>Architecture</h2>
            <p>
                The system uses a three-layer security model where each layer provides independent protection:
            </p>

            <div class="architecture-box">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE                            â”‚
â”‚                    (React / HTML Dashboard)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LAYER 1: DJANGO BACKEND                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Auth &    â”‚  â”‚   Session   â”‚  â”‚    LLM Handler          â”‚  â”‚
â”‚  â”‚    JWT      â”‚  â”‚  Management â”‚  â”‚  (OpenAI Integration)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LAYER 2: OPENAI GPT-4                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  System Prompt with Security Guidelines + Tool Schemas   â”‚    â”‚
â”‚  â”‚  â€¢ Cannot reveal PHI without authorization               â”‚    â”‚
â”‚  â”‚  â€¢ Must call MCP tools for data access                   â”‚    â”‚
â”‚  â”‚  â€¢ Respects role-based restrictions                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LAYER 3: MCP SERVER (FastAPI)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    RBAC      â”‚  â”‚    Audit     â”‚  â”‚    Data Access       â”‚   â”‚
â”‚  â”‚  Enforcement â”‚  â”‚   Logging    â”‚  â”‚    (PostgreSQL)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h3>Component Overview</h3>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Technology</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Frontend</td>
                        <td>HTML, JavaScript, Bootstrap</td>
                        <td>User interface and chat</td>
                    </tr>
                    <tr>
                        <td>Backend</td>
                        <td>Django 5.x, DRF</td>
                        <td>Auth, sessions, API gateway</td>
                    </tr>
                    <tr>
                        <td>MCP Server</td>
                        <td>FastAPI, Python</td>
                        <td>RBAC, audit, data tools</td>
                    </tr>
                    <tr>
                        <td>Database</td>
                        <td>PostgreSQL</td>
                        <td>EHR data storage</td>
                    </tr>
                    <tr>
                        <td>AI</td>
                        <td>OpenAI GPT-4</td>
                        <td>Natural language processing</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Features -->
        <section id="features">
            <h2>Features</h2>
            
            <h3>Security Features</h3>
            <ul>
                <li><strong>JWT Authentication</strong> - Secure token-based auth with refresh tokens</li>
                <li><strong>Role-Based Access Control</strong> - 6 predefined roles with granular permissions</li>
                <li><strong>Audit Logging</strong> - Every tool call logged to database</li>
                <li><strong>PHI Redaction</strong> - Sensitive data hidden from unauthorized roles</li>
                <li><strong>Session Management</strong> - Isolated chat sessions per user</li>
            </ul>

            <h3>AI Features</h3>
            <ul>
                <li><strong>Natural Language Queries</strong> - Ask questions in plain English</li>
                <li><strong>Tool Calling</strong> - AI decides which MCP tools to invoke</li>
                <li><strong>Streaming Responses</strong> - Real-time SSE streaming</li>
                <li><strong>Context Persistence</strong> - Remembers patient context across messages</li>
                <li><strong>Auto Chat Titles</strong> - Automatic naming based on first message</li>
            </ul>

            <h3>MCP Tools</h3>
            <table>
                <thead>
                    <tr>
                        <th>Tool</th>
                        <th>Description</th>
                        <th>Required Role</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>get_patient_overview</code></td>
                        <td>Basic patient demographics</td>
                        <td>All roles</td>
                    </tr>
                    <tr>
                        <td><code>get_medical_records</code></td>
                        <td>Clinical notes and diagnoses</td>
                        <td>Doctor, Nurse, Auditor</td>
                    </tr>
                    <tr>
                        <td><code>get_patient_phi</code></td>
                        <td>SSN, insurance, addresses</td>
                        <td>Full: Doctor, Admin, Auditor<br>Insurance-only: Billing</td>
                    </tr>
                    <tr>
                        <td><code>get_appointments</code></td>
                        <td>Patient appointments</td>
                        <td>All clinical roles</td>
                    </tr>
                    <tr>
                        <td><code>get_admissions</code></td>
                        <td>Hospital admissions</td>
                        <td>Doctor, Nurse, Admin</td>
                    </tr>
                    <tr>
                        <td><code>get_my_shifts</code></td>
                        <td>Current user's schedule</td>
                        <td>All staff</td>
                    </tr>
                    <tr>
                        <td><code>get_shifts</code></td>
                        <td>Department schedules</td>
                        <td>Admin, Auditor</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Prerequisites -->
        <section id="prerequisites">
            <h2>Prerequisites</h2>
            
            <p>Before running SecureHospital AI locally, ensure you have:</p>

            <div class="info-box info">
                <i class="fas fa-info-circle"></i>
                <div class="info-box-content">
                    <h4>Required Software</h4>
                    <p>Python 3.11+, PostgreSQL 14+, Node.js 18+ (optional for frontend dev), Git</p>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Requirement</th>
                        <th>Version</th>
                        <th>Check Command</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Python</td>
                        <td>3.11+</td>
                        <td><code>python --version</code></td>
                    </tr>
                    <tr>
                        <td>PostgreSQL</td>
                        <td>14+</td>
                        <td><code>psql --version</code></td>
                    </tr>
                    <tr>
                        <td>Git</td>
                        <td>Any</td>
                        <td><code>git --version</code></td>
                    </tr>
                    <tr>
                        <td>OpenAI API Key</td>
                        <td>-</td>
                        <td>From platform.openai.com</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Local Setup -->
        <section id="local-setup">
            <h2>Local Setup</h2>
            
            <p>Follow these steps to run SecureHospital AI on your local machine:</p>

            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Clone the Repository</h4>
                    <p>Get the source code from GitHub</p>
                </div>
            </div>

            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>git clone https://github.com/yourusername/securehospital-ai.git
cd securehospital-ai</code></pre>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Create Virtual Environment</h4>
                    <p>Isolate Python dependencies</p>
                </div>
            </div>

            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Create virtual environment
python -m venv venv

# Activate (Linux/Mac)
source venv/bin/activate

# Activate (Windows)
venv\Scripts\activate</code></pre>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>Install Dependencies</h4>
                    <p>Install all required Python packages</p>
                </div>
            </div>

            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Install Django backend dependencies
pip install -r requirements.txt

# Install MCP server dependencies
pip install -r mcp_server/requirements.txt</code></pre>

            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Setup Environment Variables</h4>
                    <p>Configure your local environment</p>
                </div>
            </div>

            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Copy example environment file
cp .env.example .env

# Edit with your settings
nano .env</code></pre>

            <pre><code><div class="code-header"><span class="lang">.env</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Django Settings
DEBUG=True
SECRET_KEY=your-secret-key-here
ALLOWED_HOSTS=localhost,127.0.0.1

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/securehospital

# OpenAI
OPENAI_API_KEY=sk-your-openai-api-key

# MCP Server
MCP_SERVER_URL=http://localhost:8001</code></pre>

            <div class="step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h4>Setup Database</h4>
                    <p>Create the PostgreSQL database and run migrations</p>
                </div>
            </div>

            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Create database
createdb securehospital

# Run migrations
python manage.py migrate</code></pre>

            <div class="step">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h4>Start the Servers</h4>
                    <p>Run both Django and MCP servers</p>
                </div>
            </div>

            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Terminal 1: Start Django server
python manage.py runserver

# Terminal 2: Start MCP server
cd mcp_server
uvicorn main:app --port 9000 --reload</code></pre>

            <div class="step">
                <div class="step-number">7</div>
                <div class="step-content">
                    <h4>Import Demo Data</h4>
                    <p>Populate the database with sample patients, staff, and medical records</p>
                </div>
            </div>

            <p>Visit the demo data import page in your browser:</p>

            <pre><code><div class="code-header"><span class="lang">URL</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>http://localhost:8000/seed-data/</code></pre>

            <p>Click the <strong>"Import Demo Data"</strong> button and wait for the import to complete. You'll see counts for all created records:</p>

            <ul>
                <li>6 Demo accounts (Admin, Doctor, Nurse, Billing, Reception, Auditor)</li>
                <li>50 Patients with PHI records</li>
                <li>100 Appointments</li>
                <li>80 Medical records</li>
                <li>Staff shifts and audit logs</li>
            </ul>

            <div class="info-box success">
                <i class="fas fa-check-circle"></i>
                <div class="info-box-content">
                    <h4>You're Ready!</h4>
                    <p>Open <a href="http://localhost:8000">http://localhost:8000</a> in your browser and login with demo credentials (password: <code>DemoPass123!</code>)</p>
                </div>
            </div>
        </section>

        <!-- Demo Data -->
        <section id="demo-data">
            <h2>Demo Data Import</h2>
            
            <p>SecureHospital AI includes a web-based demo data importer that creates sample patients, staff, and medical records with a single click.</p>

            <h3>Import via Web Interface</h3>
            <p>The easiest way to populate your database with demo data:</p>

            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Navigate to Import Page</h4>
                    <p>Open your browser and go to:</p>
                </div>
            </div>

            <pre><code><div class="code-header"><span class="lang">URL</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>http://localhost:8000/seed-data/</code></pre>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Click Import Button</h4>
                    <p>Click <strong>"Import Demo Data"</strong> and wait for completion</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>View Results</h4>
                    <p>The page will display counts of all created records</p>
                </div>
            </div>

            <h3>What Gets Created</h3>
            <table>
                <thead>
                    <tr>
                        <th>Data Type</th>
                        <th>Count</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Demo Accounts</td>
                        <td>6</td>
                        <td>One for each role (Admin, Doctor, Nurse, Billing, Reception, Auditor)</td>
                    </tr>
                    <tr>
                        <td>Patients</td>
                        <td>50</td>
                        <td>With full PHI records (SSN, address, insurance)</td>
                    </tr>
                    <tr>
                        <td>Appointments</td>
                        <td>100</td>
                        <td>Mix of past and future appointments</td>
                    </tr>
                    <tr>
                        <td>Medical Records</td>
                        <td>80</td>
                        <td>Diagnoses and treatments</td>
                    </tr>
                    <tr>
                        <td>Staff Shifts</td>
                        <td>50</td>
                        <td>Schedule data for staff</td>
                    </tr>
                    <tr>
                        <td>Audit Logs</td>
                        <td>100</td>
                        <td>Sample audit trail entries</td>
                    </tr>
                </tbody>
            </table>

            <h3>Demo Account Credentials</h3>
            <p>All demo accounts use the same password:</p>

            <table>
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Password</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>demo_admin</code></td>
                        <td>Admin</td>
                        <td><code>DemoPass123!</code></td>
                    </tr>
                    <tr>
                        <td><code>demo_doctor</code></td>
                        <td>Doctor</td>
                        <td><code>DemoPass123!</code></td>
                    </tr>
                    <tr>
                        <td><code>demo_nurse</code></td>
                        <td>Nurse</td>
                        <td><code>DemoPass123!</code></td>
                    </tr>
                    <tr>
                        <td><code>demo_billing</code></td>
                        <td>Billing</td>
                        <td><code>DemoPass123!</code></td>
                    </tr>
                    <tr>
                        <td><code>demo_reception</code></td>
                        <td>Reception</td>
                        <td><code>DemoPass123!</code></td>
                    </tr>
                    <tr>
                        <td><code>demo_auditor</code></td>
                        <td>Auditor</td>
                        <td><code>DemoPass123!</code></td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box warning">
                <i class="fas fa-exclamation-triangle"></i>
                <div class="info-box-content">
                    <h4>One-Time Import</h4>
                    <p>Only run the import once on a fresh database. Running it multiple times will create duplicate records.</p>
                </div>
            </div>
        </section>

        <!-- Docker Setup -->
        <section id="docker">
            <h2>Docker Setup</h2>
            
            <p>For containerized deployment, use Docker Compose:</p>

            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Build and start all services
docker-compose up --build

# Run in background
docker-compose up -d

# View logs
docker-compose logs -f

# Stop services
docker-compose down</code></pre>

            <h3>Docker Compose Services</h3>
            <table>
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Port</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>web</code></td>
                        <td>8000</td>
                        <td>Django backend</td>
                    </tr>
                    <tr>
                        <td><code>mcp</code></td>
                        <td>9000</td>
                        <td>MCP FastAPI server</td>
                    </tr>
                    <tr>
                        <td><code>db</code></td>
                        <td>5432</td>
                        <td>PostgreSQL database</td>
                    </tr>
                    <tr>
                        <td><code>redis</code></td>
                        <td>6379</td>
                        <td>Cache (optional)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Environment -->
        <section id="environment">
            <h2>Environment Variables</h2>
            
            <p>Full list of configurable environment variables:</p>

            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>SECRET_KEY</code></td>
                        <td>Yes</td>
                        <td>Django secret key</td>
                    </tr>
                    <tr>
                        <td><code>DEBUG</code></td>
                        <td>No</td>
                        <td>Debug mode (default: False)</td>
                    </tr>
                    <tr>
                        <td><code>DATABASE_URL</code></td>
                        <td>Yes</td>
                        <td>PostgreSQL connection string</td>
                    </tr>
                    <tr>
                        <td><code>OPENAI_API_KEY</code></td>
                        <td>Yes</td>
                        <td>OpenAI API key</td>
                    </tr>
                    <tr>
                        <td><code>OPENAI_MODEL</code></td>
                        <td>No</td>
                        <td>Model name (default: gpt-4)</td>
                    </tr>
                    <tr>
                        <td><code>MCP_SERVER_URL</code></td>
                        <td>Yes</td>
                        <td>MCP server URL</td>
                    </tr>
                    <tr>
                        <td><code>ALLOWED_HOSTS</code></td>
                        <td>No</td>
                        <td>Comma-separated hosts</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Database Configuration -->
        <section id="database">
            <h2>Database Configuration</h2>
            
            <p>SecureHospital AI uses PostgreSQL for storing EHR data, audit logs, and user sessions. The database schema is managed through Django migrations.</p>

            <h3>Connection Setup</h3>
            <p>Configure your database connection in the <code>.env</code> file:</p>

            <pre><code><div class="code-header"><span class="lang">.env</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Option 1: Full connection URL (recommended for production)
DATABASE_URL=postgresql://user:password@localhost:5432/securehospital

# Option 2: Individual parameters (for development)
PGHOST=localhost
PGPORT=5432
PGDATABASE=securehospital
PGUSER=your_username
PGPASSWORD=your_password

# MCP Server uses separate connection (can be same DB)
DATABASE_URL_MCP=postgresql://user:password@localhost:5432/securehospital</code></pre>

            <h3>Database Schema</h3>
            <p>The application creates several key tables:</p>

            <table>
                <thead>
                    <tr>
                        <th>Table</th>
                        <th>Purpose</th>
                        <th>PHI Level</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>ehr_patient</code></td>
                        <td>Basic patient demographics</td>
                        <td>Low</td>
                    </tr>
                    <tr>
                        <td><code>ehr_phidemographics</code></td>
                        <td>Protected Health Information (SSN, address)</td>
                        <td>High</td>
                    </tr>
                    <tr>
                        <td><code>ehr_medicalrecord</code></td>
                        <td>Clinical notes and diagnoses</td>
                        <td>High</td>
                    </tr>
                    <tr>
                        <td><code>ehr_admission</code></td>
                        <td>Hospital admissions</td>
                        <td>Medium</td>
                    </tr>
                    <tr>
                        <td><code>ehr_appointment</code></td>
                        <td>Patient appointments</td>
                        <td>Low</td>
                    </tr>
                    <tr>
                        <td><code>ehr_staff</code></td>
                        <td>Hospital staff records</td>
                        <td>Low</td>
                    </tr>
                    <tr>
                        <td><code>audit_auditlog</code></td>
                        <td>Security audit trail</td>
                        <td>Meta</td>
                    </tr>
                </tbody>
            </table>

            <h3>Migrations</h3>
            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Create migrations after model changes
python manage.py makemigrations

# Apply migrations to database
python manage.py migrate

# Load sample data for demo
python manage.py loaddata sample_data.json</code></pre>

            <div class="info-box warning">
                <i class="fas fa-exclamation-triangle"></i>
                <div class="info-box-content">
                    <h4>Production Warning</h4>
                    <p>The sample data contains fake patient records. Never use sample data in production. Always use proper database backup and encryption for real PHI.</p>
                </div>
            </div>
        </section>

        <!-- OpenAI Setup -->
        <section id="openai">
            <h2>OpenAI Setup</h2>
            
            <p>SecureHospital AI uses OpenAI's GPT models for natural language processing and function calling to interact with the MCP tools.</p>

            <h3>API Key Configuration</h3>
            <p>Obtain an API key from <a href="https://platform.openai.com" target="_blank">platform.openai.com</a> and add it to your <code>.env</code> file:</p>

            <pre><code><div class="code-header"><span class="lang">.env</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Required: Your OpenAI API key
OPENAI_API_KEY=sk-your-api-key-here

# Optional: Specify model (default: gpt-4o-mini)
OPENAI_MODEL=gpt-4o-mini</code></pre>

            <h3>Supported Models</h3>
            <table>
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Use Case</th>
                        <th>Cost</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>gpt-4o-mini</code></td>
                        <td>Default - Fast, cost-effective</td>
                        <td>Low</td>
                    </tr>
                    <tr>
                        <td><code>gpt-4o</code></td>
                        <td>Better reasoning, complex queries</td>
                        <td>Medium</td>
                    </tr>
                    <tr>
                        <td><code>gpt-4-turbo</code></td>
                        <td>Maximum capability</td>
                        <td>High</td>
                    </tr>
                </tbody>
            </table>

            <h3>Function Calling</h3>
            <p>The LLM uses OpenAI's function calling feature to invoke MCP tools. Tool definitions are passed in the system prompt:</p>

            <pre><code><div class="code-header"><span class="lang">Python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>MCP_TOOLS = [
    {
        "type": "function",
        "function": {
            "name": "get_patient_phi",
            "description": "Get Protected Health Information...",
            "parameters": {
                "type": "object",
                "properties": {
                    "patient_id": {"type": "string"}
                },
                "required": ["patient_id"]
            }
        }
    },
    # ... other tools
]</code></pre>

            <h3>Streaming Responses</h3>
            <p>The chat interface uses Server-Sent Events (SSE) for real-time streaming:</p>

            <pre><code><div class="code-header"><span class="lang">Python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Streaming is handled by StreamingLLMAgent
async for chunk in agent.stream_chat(user_message):
    yield f"data: {json.dumps(chunk)}\n\n"</code></pre>

            <div class="info-box info">
                <i class="fas fa-info-circle"></i>
                <div class="info-box-content">
                    <h4>Cost Management</h4>
                    <p>Each message uses tokens from your OpenAI account. The default gpt-4o-mini model costs approximately $0.15 per 1M input tokens and $0.60 per 1M output tokens.</p>
                </div>
            </div>
        </section>

        <!-- MCP Server -->
        <section id="mcp-server">
            <h2>MCP Server Configuration</h2>
            
            <p>The Model Context Protocol (MCP) server is a FastAPI application that provides the security layer between the LLM and your database. It enforces RBAC, performs PHI redaction, and logs all access attempts.</p>

            <h3>Server Configuration</h3>
            <pre><code><div class="code-header"><span class="lang">.env</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># MCP Server URL (Django connects here)
MCP_SERVER_URL=http://localhost:9000

# JWT Authentication (must match Django's SECRET_KEY)
SECRET_KEY=your-django-secret-key

# Database connection for MCP server
DATABASE_URL_MCP=postgresql://user:password@localhost:5432/securehospital

# Optional: SSL mode for database
MCP_DB_SSLMODE=require</code></pre>

            <h3>Starting the MCP Server</h3>
            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div># Development mode with auto-reload
cd mcp_server
uvicorn main:app --host 0.0.0.0 --port 9000 --reload

# Production mode
uvicorn main:app --host 0.0.0.0 --port 9000 --workers 4</code></pre>

            <h3>Available MCP Tools</h3>
            <p>The MCP server exposes these JSON-RPC tools:</p>

            <table>
                <thead>
                    <tr>
                        <th>Tool</th>
                        <th>Description</th>
                        <th>PHI Access</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>get_patient_overview</code></td>
                        <td>Basic demographics (name, DOB year, gender)</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td><code>get_patient_phi</code></td>
                        <td>SSN, address, insurance (role-based redaction)</td>
                        <td>Full/Redacted/Insurance-Only</td>
                    </tr>
                    <tr>
                        <td><code>get_medical_records</code></td>
                        <td>Clinical notes and diagnoses</td>
                        <td>Clinical</td>
                    </tr>
                    <tr>
                        <td><code>get_appointments</code></td>
                        <td>Patient appointments</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td><code>get_admissions</code></td>
                        <td>Hospital admissions</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td><code>get_my_shifts</code></td>
                        <td>Current user's schedule</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td><code>get_shifts</code></td>
                        <td>Department schedules (Admin/Auditor only)</td>
                        <td>None</td>
                    </tr>
                </tbody>
            </table>

            <h3>PHI Redaction by Role</h3>
            <p>The MCP server automatically redacts PHI based on user role:</p>

            <table>
                <thead>
                    <tr>
                        <th>Role</th>
                        <th>PHI Access Level</th>
                        <th>Fields Visible</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Admin, Doctor, Auditor</td>
                        <td>Full</td>
                        <td>All PHI fields including SSN</td>
                    </tr>
                    <tr>
                        <td>Nurse</td>
                        <td>Redacted</td>
                        <td>DOB visible, SSN/address hidden</td>
                    </tr>
                    <tr>
                        <td>Billing</td>
                        <td>Insurance Only</td>
                        <td>insurance_provider, insurance_number only</td>
                    </tr>
                    <tr>
                        <td>Reception</td>
                        <td>Denied</td>
                        <td>No PHI access</td>
                    </tr>
                </tbody>
            </table>

            <h3>JSON-RPC Protocol</h3>
            <p>The MCP server uses JSON-RPC 2.0 for communication:</p>

            <pre><code><div class="code-header"><span class="lang">JSON Request</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>{
    "jsonrpc": "2.0",
    "id": "unique-request-id",
    "method": "tools.call",
    "params": {
        "name": "get_patient_phi",
        "arguments": {"patient_id": "FCE57"}
    }
}</code></pre>

            <pre><code><div class="code-header"><span class="lang">JSON Response (Success)</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>{
    "jsonrpc": "2.0",
    "id": "unique-request-id",
    "result": {
        "data": {
            "patient_id": "FCE57",
            "insurance_provider": "BlueCross",
            "insurance_number": "BC-12345",
            "_access_level": "insurance_only"
        }
    }
}</code></pre>

            <h3>Health Check</h3>
            <p>Verify the MCP server is running:</p>

            <pre><code><div class="code-header"><span class="lang">Bash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>curl http://localhost:9000/health
# Response: {"status": "ok", "service": "mcp-server", "version": "2.0"}</code></pre>

            <div class="info-box success">
                <i class="fas fa-check-circle"></i>
                <div class="info-box-content">
                    <h4>Security Note</h4>
                    <p>The MCP server validates JWT tokens using the same SECRET_KEY as Django. This ensures only authenticated users can access data tools.</p>
                </div>
            </div>
        </section>

        <!-- RBAC -->
        <section id="rbac">
            <h2>Role-Based Access Control</h2>
            
            <p>SecureHospital AI implements healthcare-specific RBAC with 6 predefined roles:</p>

            <table>
                <thead>
                    <tr>
                        <th>Role</th>
                        <th>Patient Data</th>
                        <th>Medical Records</th>
                        <th>PHI Access</th>
                        <th>Scheduling</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Admin</strong></td>
                        <td>âœ… Full</td>
                        <td>âœ… Full</td>
                        <td>âœ… Full</td>
                        <td>âœ… All Staff</td>
                    </tr>
                    <tr>
                        <td><strong>Doctor</strong></td>
                        <td>âœ… Full</td>
                        <td>âœ… Full</td>
                        <td>âœ… Full</td>
                        <td>Own Only</td>
                    </tr>
                    <tr>
                        <td><strong>Nurse</strong></td>
                        <td>âœ… Full</td>
                        <td>âœ… Full</td>
                        <td>Limited</td>
                        <td>Own Only</td>
                    </tr>
                    <tr>
                        <td><strong>Auditor</strong></td>
                        <td>âœ… Read</td>
                        <td>âœ… Read</td>
                        <td>âœ… Read</td>
                        <td>âœ… All (Read)</td>
                    </tr>
                    <tr>
                        <td><strong>Reception</strong></td>
                        <td>Basic Only</td>
                        <td>âŒ No</td>
                        <td>âŒ No</td>
                        <td>Own Only</td>
                    </tr>
                    <tr>
                        <td><strong>Billing</strong></td>
                        <td>Demographics</td>
                        <td>âŒ No</td>
                        <td>Insurance Only</td>
                        <td>Own Only</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box warning">
                <i class="fas fa-exclamation-triangle"></i>
                <div class="info-box-content">
                    <h4>RBAC Enforcement</h4>
                    <p>Access control is enforced at the MCP layer. Even if a user asks the AI for unauthorized data, the MCP server will reject the request and log the attempt.</p>
                </div>
            </div>
        </section>

        <!-- Audit Logging -->
        <section id="audit-logging">
            <h2>Audit Logging</h2>
            
            <p>Every data access is logged to the <code>audit_log</code> table:</p>

            <pre><code><div class="code-header"><span class="lang">SQL Schema</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>CREATE TABLE audit_log (
    id UUID PRIMARY KEY,
    timestamp TIMESTAMP NOT NULL,
    user_id UUID REFERENCES users(id),
    staff_id UUID REFERENCES staff(staff_id),
    action VARCHAR(50) NOT NULL,
    table_name VARCHAR(100),
    record_id VARCHAR(100),
    details JSONB,
    ip_address VARCHAR(45),
    user_agent TEXT
);</code></pre>

            <h3>Logged Actions</h3>
            <ul>
                <li><code>TOOL_CALL</code> - MCP tool invocation</li>
                <li><code>ACCESS_GRANTED</code> - Successful data access</li>
                <li><code>ACCESS_DENIED</code> - RBAC rejection</li>
                <li><code>PHI_ACCESS</code> - Protected data viewed</li>
                <li><code>LOGIN</code> / <code>LOGOUT</code> - Session events</li>
            </ul>
        </section>

        <!-- PHI Protection -->
        <section id="phi-protection">
            <h2>PHI Protection</h2>
            
            <p>Protected Health Information (PHI) includes:</p>

            <ul>
                <li>Social Security Numbers</li>
                <li>Full addresses</li>
                <li>Phone numbers</li>
                <li>Insurance policy numbers</li>
                <li>Medical record numbers</li>
                <li>Detailed diagnosis information</li>
            </ul>

            <div class="info-box danger">
                <i class="fas fa-shield-alt"></i>
                <div class="info-box-content">
                    <h4>PHI Access Levels</h4>
                    <p><strong>Full Access:</strong> Doctor, Admin, Auditor can see all PHI including SSN.<br>
                    <strong>Redacted:</strong> Nurse sees DOB but SSN/address are masked.<br>
                    <strong>Insurance Only:</strong> Billing sees only insurance_provider and insurance_number.<br>
                    <strong>No Access:</strong> Reception cannot access PHI data.</p>
                </div>
            </div>
        </section>

        <!-- Troubleshooting -->
        <section id="troubleshooting">
            <h2>Troubleshooting</h2>
            
            <h3>Common Issues</h3>

            <h4>MCP Server Connection Failed</h4>
            <pre><code><div class="code-header"><span class="lang">Error</span></div>ConnectionError: Unable to connect to MCP server</code></pre>
            <p><strong>Solution:</strong> Ensure the MCP server is running on port 8001. Check <code>MCP_SERVER_URL</code> in your <code>.env</code> file.</p>

            <h4>OpenAI API Error</h4>
            <pre><code><div class="code-header"><span class="lang">Error</span></div>openai.AuthenticationError: Invalid API key</code></pre>
            <p><strong>Solution:</strong> Verify your <code>OPENAI_API_KEY</code> is correct and has sufficient credits.</p>

            <h4>Database Connection Error</h4>
            <pre><code><div class="code-header"><span class="lang">Error</span></div>django.db.utils.OperationalError: connection refused</code></pre>
            <p><strong>Solution:</strong> Ensure PostgreSQL is running and <code>DATABASE_URL</code> is correct.</p>

            <h4>Async/Sync Django Error</h4>
            <pre><code><div class="code-header"><span class="lang">Error</span></div>SynchronousOnlyOperation: You cannot call this from an async context</code></pre>
            <p><strong>Solution:</strong> Wrap Django ORM calls with <code>@sync_to_async</code> decorator in async functions.</p>
        </section>

        <!-- Footer Navigation -->
        <div class="docs-footer">
            <a href="/">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
            <a href="{% url 'frontend:api_reference' %}">
                API Reference <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </main>
</div>

<script>
function copyCode(btn) {
    const pre = btn.closest('pre');
    const code = pre.querySelector('code');
    const text = code.innerText.split('\n').slice(1).join('\n'); // Skip header line
    
    navigator.clipboard.writeText(text).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy', 2000);
    });
}

// Highlight current section in sidebar
document.addEventListener('scroll', () => {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.sidebar-nav a');
    
    let current = '';
    sections.forEach(section => {
        const sectionTop = section.offsetTop - 100;
        if (scrollY >= sectionTop) {
            current = section.getAttribute('id');
        }
    });
    
    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + current) {
            link.classList.add('active');
        }
    });
});
</script>

</body>
</html>